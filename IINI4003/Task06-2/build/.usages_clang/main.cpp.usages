22 serialization::archive 17 0 0 0 0 38 /home/dereandor/Code/IINI4003/Task06-2 44 /home/dereandor/Code/IINI4003/Task06-2/build 0 0 446 0 0 0 1 # 1 1 1 2 18446744073709551615 7 include 1 2 1 9 18446744073709551615 1 < 1 10 1 11 18446744073709551615 5 boost 1 11 1 16 18446744073709551615 1 / 1 16 1 17 18446744073709551615 4 asio 1 17 1 21 18446744073709551615 1 . 1 21 1 22 18446744073709551615 3 hpp 1 22 1 25 18446744073709551615 1 > 1 25 1 26 18446744073709551615 1 # 2 1 2 2 18446744073709551615 7 include 2 2 2 9 18446744073709551615 1 < 2 10 2 11 18446744073709551615 8 iostream 2 11 2 19 18446744073709551615 1 > 2 19 2 20 18446744073709551615 5 using 4 1 4 6 18446744073709551615 9 namespace 4 7 4 16 18446744073709551615 3 std 4 17 4 20 0 1 ; 4 20 4 21 18446744073709551615 5 using 5 1 5 6 18446744073709551615 9 namespace 5 7 5 16 18446744073709551615 5 boost 5 17 5 22 1 2 :: 5 22 5 24 18446744073709551615 4 asio 5 24 5 28 2 2 :: 5 28 5 30 18446744073709551615 2 ip 5 30 5 32 3 1 ; 5 32 5 33 18446744073709551615 5 class 7 1 7 6 18446744073709551615 9 WebServer 7 7 7 16 4 1 { 7 17 7 18 18446744073709551615 7 private 8 1 8 8 18446744073709551615 1 : 8 8 8 9 18446744073709551615 5 class 9 3 9 8 18446744073709551615 10 Connection 9 9 9 19 5 1 { 9 20 9 21 18446744073709551615 6 public 10 3 10 9 18446744073709551615 1 : 10 9 10 10 18446744073709551615 3 tcp 11 5 11 8 6 2 :: 11 8 11 10 18446744073709551615 6 socket 11 10 11 16 7 6 socket 11 17 11 23 8 1 ; 11 23 11 24 18446744073709551615 10 Connection 12 5 12 15 5 1 ( 12 15 12 16 5 5 boost 12 16 12 21 1 2 :: 12 21 12 23 18446744073709551615 4 asio 12 23 12 27 2 2 :: 12 27 12 29 18446744073709551615 10 io_service 12 29 12 39 9 1 & 12 40 12 41 18446744073709551615 10 io_service 12 41 12 51 10 1 ) 12 51 12 52 5 1 : 12 53 12 54 5 6 socket 12 55 12 61 8 1 ( 12 61 12 62 11 10 io_service 12 62 12 72 10 1 ) 12 72 12 73 11 1 { 12 74 12 75 18446744073709551615 1 } 12 75 12 76 18446744073709551615 1 } 13 3 13 4 18446744073709551615 1 ; 13 4 13 5 18446744073709551615 5 boost 15 3 15 8 1 2 :: 15 8 15 10 18446744073709551615 4 asio 15 10 15 14 2 2 :: 15 14 15 16 18446744073709551615 10 io_service 15 16 15 26 9 10 io_service 15 27 15 37 12 1 ; 15 37 15 38 18446744073709551615 3 tcp 17 3 17 6 6 2 :: 17 6 17 8 18446744073709551615 8 endpoint 17 8 17 16 13 8 endpoint 17 17 17 25 14 1 ; 17 25 17 26 18446744073709551615 3 tcp 18 3 18 6 6 2 :: 18 6 18 8 18446744073709551615 8 acceptor 18 8 18 16 15 8 acceptor 18 17 18 25 16 1 ; 18 25 18 26 18446744073709551615 4 void 20 3 20 7 18446744073709551615 14 handle_request 20 8 20 22 17 1 ( 20 22 20 23 17 10 shared_ptr 20 23 20 33 18 1 < 20 33 20 34 18446744073709551615 10 Connection 20 34 20 44 5 1 > 20 44 20 45 18446744073709551615 10 connection 20 46 20 56 19 1 ) 20 56 20 57 17 1 { 20 58 20 59 18446744073709551615 4 auto 21 5 21 9 18446744073709551615 11 read_buffer 21 10 21 21 20 1 = 21 22 21 23 18446744073709551615 11 make_shared 21 24 21 35 21 1 < 21 35 21 36 21 5 boost 21 36 21 41 1 2 :: 21 41 21 43 21 4 asio 21 43 21 47 2 2 :: 21 47 21 49 21 9 streambuf 21 49 21 58 22 1 > 21 58 21 59 21 1 ( 21 59 21 60 21 1 ) 21 60 21 61 21 1 ; 21 61 21 62 18446744073709551615 42 // Read from client until newline ("\r\n") 22 5 22 47 18446744073709551615 16 async_read_until 23 5 23 21 23 1 ( 23 21 23 22 23 10 connection 23 22 23 32 19 2 -> 23 32 23 34 18446744073709551615 6 socket 23 34 23 40 8 1 , 23 40 23 41 23 1 * 23 42 23 43 24 11 read_buffer 23 43 23 54 20 1 , 23 54 23 55 23 6 "\r\n" 23 56 23 62 18446744073709551615 1 , 23 62 23 63 23 1 [ 24 22 24 23 18446744073709551615 4 this 24 23 24 27 18446744073709551615 1 , 24 27 24 28 18446744073709551615 10 connection 24 29 24 39 19 1 , 24 39 24 40 18446744073709551615 11 read_buffer 24 41 24 52 20 1 ] 24 52 24 53 18446744073709551615 1 ( 24 53 24 54 18446744073709551615 5 const 24 54 24 59 18446744073709551615 5 boost 24 60 24 65 1 2 :: 24 65 24 67 18446744073709551615 6 system 24 67 24 73 25 2 :: 24 73 24 75 18446744073709551615 10 error_code 24 75 24 85 26 1 & 24 86 24 87 18446744073709551615 2 ec 24 87 24 89 27 1 , 24 89 24 90 18446744073709551615 6 size_t 24 91 24 97 28 1 ) 24 97 24 98 18446744073709551615 1 { 24 99 24 100 18446744073709551615 16 // If not error: 25 24 25 40 18446744073709551615 2 if 26 24 26 26 18446744073709551615 1 ( 26 27 26 28 18446744073709551615 1 ! 26 28 26 29 18446744073709551615 2 ec 26 29 26 31 27 1 ) 26 31 26 32 18446744073709551615 1 { 26 33 26 34 18446744073709551615 42 // Retrieve message from client as string: 27 26 27 68 18446744073709551615 7 istream 28 26 28 33 29 11 read_stream 28 34 28 45 30 1 ( 28 45 28 46 31 11 read_buffer 28 46 28 57 20 1 . 28 57 28 58 32 3 get 28 58 28 61 32 1 ( 28 61 28 62 32 1 ) 28 62 28 63 32 1 ) 28 63 28 64 31 1 ; 28 64 28 65 18446744073709551615 3 std 29 26 29 29 0 2 :: 29 29 29 31 18446744073709551615 6 string 29 31 29 37 33 7 message 29 38 29 45 34 1 ; 29 45 29 46 18446744073709551615 7 getline 30 26 30 33 35 1 ( 30 33 30 34 35 11 read_stream 30 34 30 45 30 1 , 30 45 30 46 35 7 message 30 47 30 54 34 1 ) 30 54 30 55 35 1 ; 30 55 30 56 18446744073709551615 7 message 31 26 31 33 34 1 . 31 33 31 34 36 8 pop_back 31 34 31 42 36 1 ( 31 42 31 43 36 1 ) 31 43 31 44 36 1 ; 31 44 31 45 18446744073709551615 36 // Remove "\r" at the end of message 31 46 31 82 18446744073709551615 6 string 33 26 33 32 33 8 response 33 33 33 41 37 1 = 33 42 33 43 18446744073709551615 2 "" 33 44 33 46 18446744073709551615 1 ; 33 46 33 47 18446744073709551615 56 // Close connection when "exit" is retrieved from client 34 26 34 82 18446744073709551615 2 if 35 26 35 28 18446744073709551615 1 ( 35 29 35 30 18446744073709551615 7 message 35 30 35 37 34 2 == 35 38 35 40 38 6 "exit" 35 41 35 47 18446744073709551615 1 ) 35 47 35 48 18446744073709551615 1 { 35 49 35 50 18446744073709551615 6 return 36 28 36 34 18446744073709551615 1 ; 36 34 36 35 18446744073709551615 1 } 37 26 37 27 18446744073709551615 4 else 37 28 37 32 18446744073709551615 2 if 37 33 37 35 18446744073709551615 1 ( 37 36 37 37 18446744073709551615 7 message 37 37 37 44 34 2 == 37 45 37 47 38 16 "GET / HTTP/1.1" 37 48 37 64 18446744073709551615 1 ) 37 64 37 65 18446744073709551615 1 { 37 66 37 67 18446744073709551615 8 response 38 28 38 36 37 1 = 38 37 38 38 39 29 "Dette er hovedsiden\r\n\r\n" 38 39 38 68 18446744073709551615 1 ; 38 68 38 69 18446744073709551615 1 } 39 26 39 27 18446744073709551615 4 else 39 28 39 32 18446744073709551615 2 if 39 33 39 35 18446744073709551615 1 ( 39 36 39 37 18446744073709551615 7 message 39 37 39 44 34 2 == 39 45 39 47 38 23 "GET /en_side HTTP/1.1" 39 48 39 71 18446744073709551615 1 ) 39 71 39 72 18446744073709551615 1 { 39 73 39 74 18446744073709551615 8 response 40 28 40 36 37 1 = 40 37 40 38 39 26 "Dette er en side\r\n\r\n" 40 39 40 65 18446744073709551615 1 ; 40 65 40 66 18446744073709551615 1 } 41 26 41 27 18446744073709551615 4 else 41 28 41 32 18446744073709551615 1 { 41 33 41 34 18446744073709551615 8 response 42 28 42 36 37 1 = 42 37 42 38 39 32 "HTTP/1.1 404 Not Found\r\n\r\n" 42 39 42 71 18446744073709551615 1 ; 42 71 42 72 18446744073709551615 1 } 43 26 43 27 18446744073709551615 4 cout 45 26 45 30 40 2 << 45 31 45 33 41 35 "Message from a connected client: " 45 34 45 69 18446744073709551615 2 << 45 70 45 72 41 7 message 45 73 45 80 34 2 << 45 81 45 83 42 4 endl 45 84 45 88 43 1 ; 45 88 45 89 18446744073709551615 4 auto 47 26 47 30 18446744073709551615 12 write_buffer 47 31 47 43 44 1 = 47 44 47 45 18446744073709551615 11 make_shared 47 46 47 57 21 1 < 47 57 47 58 21 5 boost 47 58 47 63 1 2 :: 47 63 47 65 21 4 asio 47 65 47 69 2 2 :: 47 69 47 71 21 9 streambuf 47 71 47 80 22 1 > 47 80 47 81 21 1 ( 47 81 47 82 21 1 ) 47 82 47 83 21 1 ; 47 83 47 84 18446744073709551615 7 ostream 48 26 48 33 45 12 write_stream 48 34 48 46 46 1 ( 48 46 48 47 47 12 write_buffer 48 47 48 59 44 1 . 48 59 48 60 32 3 get 48 60 48 63 32 1 ( 48 63 48 64 32 1 ) 48 64 48 65 32 1 ) 48 65 48 66 47 1 ; 48 66 48 67 18446744073709551615 39 // Add message to be written to client: 50 26 50 65 18446744073709551615 12 write_stream 51 26 51 38 46 2 << 51 39 51 41 41 8 response 51 42 51 50 37 1 ; 51 50 51 51 18446744073709551615 18 // Write to client 53 26 53 44 18446744073709551615 11 async_write 54 26 54 37 48 1 ( 54 37 54 38 48 10 connection 54 38 54 48 19 2 -> 54 48 54 50 18446744073709551615 6 socket 54 50 54 56 8 1 , 54 56 54 57 48 1 * 54 58 54 59 24 12 write_buffer 54 59 54 71 44 1 , 54 71 54 72 48 1 [ 55 38 55 39 18446744073709551615 4 this 55 39 55 43 18446744073709551615 1 , 55 43 55 44 18446744073709551615 10 connection 55 45 55 55 19 1 , 55 55 55 56 18446744073709551615 12 write_buffer 55 57 55 69 44 1 ] 55 69 55 70 18446744073709551615 1 ( 55 70 55 71 18446744073709551615 5 const 55 71 55 76 18446744073709551615 5 boost 55 77 55 82 1 2 :: 55 82 55 84 18446744073709551615 6 system 55 84 55 90 25 2 :: 55 90 55 92 18446744073709551615 10 error_code 55 92 55 102 26 1 & 55 103 55 104 18446744073709551615 2 ec 55 104 55 106 49 1 , 55 106 55 107 18446744073709551615 6 size_t 55 108 55 114 28 1 ) 55 114 55 115 18446744073709551615 1 { 55 116 55 117 18446744073709551615 16 // If not error: 56 40 56 56 18446744073709551615 2 if 57 40 57 42 18446744073709551615 1 ( 57 43 57 44 18446744073709551615 1 ! 57 44 57 45 18446744073709551615 2 ec 57 45 57 47 49 1 ) 57 47 57 48 18446744073709551615 14 handle_request 58 42 58 56 17 1 ( 58 56 58 57 17 10 connection 58 57 58 67 19 1 ) 58 67 58 68 17 1 ; 58 68 58 69 18446744073709551615 53 // Close socket for displaying content in web browser 60 40 60 93 18446744073709551615 10 connection 61 40 61 50 19 2 -> 61 50 61 52 18446744073709551615 6 socket 61 52 61 58 8 1 . 61 58 61 59 50 5 close 61 59 61 64 50 1 ( 61 64 61 65 50 1 ) 61 65 61 66 50 1 ; 61 66 61 67 18446744073709551615 1 } 62 38 62 39 18446744073709551615 1 ) 62 39 62 40 48 1 ; 62 40 62 41 18446744073709551615 1 } 63 24 63 25 18446744073709551615 1 } 64 22 64 23 18446744073709551615 1 ) 64 23 64 24 23 1 ; 64 24 64 25 18446744073709551615 1 } 65 3 65 4 18446744073709551615 4 void 67 3 67 7 18446744073709551615 6 accept 67 8 67 14 51 1 ( 67 14 67 15 51 1 ) 67 15 67 16 51 1 { 67 17 67 18 18446744073709551615 78 // The (client) connection is added to the lambda parameter and handle_request 68 5 68 83 18446744073709551615 65 // in order to keep the object alive for as long as it is needed. 69 5 69 70 18446744073709551615 4 auto 70 5 70 9 18446744073709551615 10 connection 70 10 70 20 52 1 = 70 21 70 22 18446744073709551615 11 make_shared 70 23 70 34 21 1 < 70 34 70 35 21 10 Connection 70 35 70 45 5 1 > 70 45 70 46 21 1 ( 70 46 70 47 21 10 io_service 70 47 70 57 12 1 ) 70 57 70 58 21 1 ; 70 58 70 59 18446744073709551615 97 // Accepts a new (client) connection. On connection, immediately start accepting a new connection 72 5 72 102 18446744073709551615 8 acceptor 73 5 73 13 16 1 . 73 13 73 14 53 12 async_accept 73 14 73 26 53 1 ( 73 26 73 27 53 10 connection 73 27 73 37 52 2 -> 73 37 73 39 18446744073709551615 6 socket 73 39 73 45 8 1 , 73 45 73 46 53 1 [ 73 47 73 48 18446744073709551615 4 this 73 48 73 52 18446744073709551615 1 , 73 52 73 53 18446744073709551615 10 connection 73 54 73 64 52 1 ] 73 64 73 65 18446744073709551615 1 ( 73 65 73 66 18446744073709551615 5 const 73 66 73 71 18446744073709551615 5 boost 73 72 73 77 1 2 :: 73 77 73 79 18446744073709551615 6 system 73 79 73 85 25 2 :: 73 85 73 87 18446744073709551615 10 error_code 73 87 73 97 26 1 & 73 98 73 99 18446744073709551615 2 ec 73 99 73 101 54 1 ) 73 101 73 102 18446744073709551615 1 { 73 103 73 104 18446744073709551615 6 accept 74 7 74 13 51 1 ( 74 13 74 14 51 1 ) 74 14 74 15 51 1 ; 74 15 74 16 18446744073709551615 16 // If not error: 75 7 75 23 18446744073709551615 2 if 76 7 76 9 18446744073709551615 1 ( 76 10 76 11 18446744073709551615 1 ! 76 11 76 12 18446744073709551615 2 ec 76 12 76 14 54 1 ) 76 14 76 15 18446744073709551615 1 { 76 16 76 17 18446744073709551615 14 handle_request 77 9 77 23 17 1 ( 77 23 77 24 17 10 connection 77 24 77 34 52 1 ) 77 34 77 35 17 1 ; 77 35 77 36 18446744073709551615 1 } 78 7 78 8 18446744073709551615 1 } 79 5 79 6 18446744073709551615 1 ) 79 6 79 7 53 1 ; 79 7 79 8 18446744073709551615 1 } 80 3 80 4 18446744073709551615 6 public 82 1 82 7 18446744073709551615 1 : 82 7 82 8 18446744073709551615 9 WebServer 83 3 83 12 4 1 ( 83 12 83 13 4 1 ) 83 13 83 14 4 1 : 83 15 83 16 4 8 endpoint 83 17 83 25 14 1 ( 83 25 83 26 55 3 tcp 83 26 83 29 6 2 :: 83 29 83 31 56 2 v4 83 31 83 33 56 1 ( 83 33 83 34 56 1 ) 83 34 83 35 56 1 , 83 35 83 36 55 4 8080 83 37 83 41 18446744073709551615 1 ) 83 41 83 42 55 1 , 83 42 83 43 4 8 acceptor 83 44 83 52 16 1 ( 83 52 83 53 57 10 io_service 83 53 83 63 12 1 , 83 63 83 64 57 8 endpoint 83 65 83 73 14 1 ) 83 73 83 74 57 1 { 83 75 83 76 18446744073709551615 1 } 83 76 83 77 18446744073709551615 4 void 85 3 85 7 18446744073709551615 5 start 85 8 85 13 58 1 ( 85 13 85 14 58 1 ) 85 14 85 15 58 1 { 85 16 85 17 18446744073709551615 6 accept 86 5 86 11 51 1 ( 86 11 86 12 51 1 ) 86 12 86 13 51 1 ; 86 13 86 14 18446744073709551615 10 io_service 88 5 88 15 12 1 . 88 15 88 16 59 3 run 88 16 88 19 59 1 ( 88 19 88 20 59 1 ) 88 20 88 21 59 1 ; 88 21 88 22 18446744073709551615 1 } 89 3 89 4 18446744073709551615 1 } 90 1 90 2 18446744073709551615 1 ; 90 2 90 3 18446744073709551615 3 int 92 1 92 4 18446744073709551615 4 main 92 5 92 9 60 1 ( 92 9 92 10 60 1 ) 92 10 92 11 60 1 { 92 12 92 13 18446744073709551615 9 WebServer 93 3 93 12 4 11 echo_server 93 13 93 24 61 1 ; 93 24 93 25 18446744073709551615 4 cout 95 3 95 7 40 2 << 95 8 95 10 41 22 "Starting echo server" 95 11 95 33 18446744073709551615 2 << 95 34 95 36 42 4 endl 95 37 95 41 43 2 << 96 8 96 10 41 83 "Connect in a terminal with: telnet localhost 8080. Type 'exit' to end connection." 96 11 96 94 18446744073709551615 2 << 96 95 96 97 42 4 endl 96 98 96 102 43 1 ; 96 102 96 103 18446744073709551615 11 echo_server 98 3 98 14 61 1 . 98 14 98 15 58 5 start 98 15 98 20 58 1 ( 98 20 98 21 58 1 ) 98 21 98 22 58 1 ; 98 22 98 23 18446744073709551615 1 } 99 1 99 2 18446744073709551615 0 0 62 0 0 0 22 0 0 1 13 0 3 std 22 1 13 0 5 boost 22 1 13 0 10 asio:boost 22 1 13 0 13 ip:asio:boost 4 1 13 0 9 WebServer 4 1 13 0 20 Connection:WebServer 4 1 13 0 17 tcp:ip:asio:boost 20 1 13 0 24 socket:tcp:ip:asio:boost 6 1 13 0 27 socket:Connection:WebServer 20 1 13 0 21 io_service:asio:boost 10 1 13 0 53 12:41:/home/dereandor/Code/IINI4003/Task06-2/main.cpp 24 1 13 0 30 basic_stream_socket:asio:boost 6 1 13 0 20 io_service:WebServer 20 1 13 0 26 endpoint:tcp:ip:asio:boost 6 1 13 0 18 endpoint:WebServer 20 1 13 0 26 acceptor:tcp:ip:asio:boost 6 1 13 0 18 acceptor:WebServer 21 1 13 0 24 handle_request:WebServer 31 1 13 0 14 shared_ptr:std 10 1 13 0 53 20:46:/home/dereandor/Code/IINI4003/Task06-2/main.cpp 9 1 13 0 53 21:10:/home/dereandor/Code/IINI4003/Task06-2/main.cpp 8 1 13 0 15 make_shared:std 20 1 13 0 20 streambuf:asio:boost 8 1 13 0 27 async_read_until:asio:boost 21 1 13 0 33 operator*:__shared_ptr_access:std 22 1 13 0 12 system:boost 4 1 13 0 23 error_code:system:boost 10 1 13 0 53 24:87:/home/dereandor/Code/IINI4003/Task06-2/main.cpp 20 1 13 0 6 size_t 20 1 13 0 11 istream:std 9 1 13 0 53 28:34:/home/dereandor/Code/IINI4003/Task06-2/main.cpp 24 1 13 0 17 basic_istream:std 21 1 13 0 20 get:__shared_ptr:std 20 1 13 0 10 string:std 9 1 13 0 53 29:38:/home/dereandor/Code/IINI4003/Task06-2/main.cpp 8 1 13 0 11 getline:std 21 1 13 0 33 pop_back:basic_string:__cxx11:std 9 1 13 0 53 33:33:/home/dereandor/Code/IINI4003/Task06-2/main.cpp 8 1 13 0 14 operator==:std 21 1 13 0 34 operator=:basic_string:__cxx11:std 9 1 13 0 8 cout:std 8 1 13 0 12 operator:std 21 1 13 0 26 operator:basic_ostream:std 8 1 13 0 8 endl:std 9 1 13 0 53 47:31:/home/dereandor/Code/IINI4003/Task06-2/main.cpp 20 1 13 0 11 ostream:std 9 1 13 0 53 48:34:/home/dereandor/Code/IINI4003/Task06-2/main.cpp 24 1 13 0 17 basic_ostream:std 8 1 13 0 22 async_write:asio:boost 10 1 13 0 54 55:104:/home/dereandor/Code/IINI4003/Task06-2/main.cpp 21 1 13 0 29 close:basic_socket:asio:boost 21 1 13 0 16 accept:WebServer 9 1 13 0 53 70:10:/home/dereandor/Code/IINI4003/Task06-2/main.cpp 21 1 13 0 45 async_accept:basic_socket_acceptor:asio:boost 10 1 13 0 53 73:99:/home/dereandor/Code/IINI4003/Task06-2/main.cpp 24 1 13 0 28 basic_endpoint:ip:asio:boost 21 1 13 0 20 v4:tcp:ip:asio:boost 24 1 13 0 32 basic_socket_acceptor:asio:boost 21 1 13 0 15 start:WebServer 21 1 13 0 25 run:io_context:asio:boost 8 1 13 0 4 main 9 1 13 0 53 93:13:/home/dereandor/Code/IINI4003/Task06-2/main.cpp 0 0 1 0 0 0 47 /home/dereandor/Code/IINI4003/Task06-2/main.cpp 1601919547